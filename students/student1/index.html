import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Button } from "@/components/ui/button";

export default function StudentPortal() {
  const [posts, setPosts] = useState([
    { id: 1, content: "ë„ì„œê´€ ì—ì–´ì»¨ ë„ˆë¬´ ì¶”ì›Œìš” ã… ã… ", likes: 0, comments: [], reported: false },
    { id: 2, content: "í¸ì˜ì  ì‹ ë©”ë‰´ ì¡´ë§›íƒ±.. ì¶”ì²œí•¨", likes: 0, comments: [], reported: false }
  ]);
  const [newPost, setNewPost] = useState("");
  const [commentInputs, setCommentInputs] = useState({});
  const [newEvent, setNewEvent] = useState({ name: "", title: "" });
  const [eventList, setEventList] = useState([
    { date: "5ì›” 10ì¼", title: "ë´„ ì¶•ì œ" },
    { date: "6ì›” 1ì¼", title: "ë™ì•„ë¦¬ ì „ì‹œíšŒ" },
    { date: "6ì›” 20ì¼", title: "ì¢…ê°•íŒŒí‹°" }
  ]);

  const handlePost = () => {
    if (newPost.trim() === "") return;
    setPosts([
      ...posts,
      { id: posts.length + 1, content: newPost, likes: 0, comments: [], reported: false }
    ]);
    setNewPost("");
  };

  const handleLike = (id) => {
    setPosts(posts.map(p => p.id === id ? { ...p, likes: p.likes + 1 } : p));
  };

  const handleReport = (id) => {
    setPosts(posts.map(p => p.id === id ? { ...p, reported: true } : p));
  };

  const handleComment = (id) => {
    const comment = commentInputs[id];
    if (!comment || comment.trim() === "") return;
    setPosts(posts.map(p => p.id === id ? { ...p, comments: [...p.comments, comment] } : p));
    setCommentInputs({ ...commentInputs, [id]: "" });
  };

  const handleAddEvent = (e) => {
    e.preventDefault();
    if (newEvent.name.trim() === "" || newEvent.title.trim() === "") return;
    const today = new Date();
    const dateStr = `${today.getMonth() + 1}ì›” ${today.getDate()}ì¼`;
    setEventList([...eventList, { date: dateStr, title: newEvent.title }]);
    setNewEvent({ name: "", title: "" });
  };

  return (
    <div className="p-6 max-w-5xl mx-auto">
      <h1 className="text-3xl font-bold mb-6">ğŸ“ í•™ìƒ í¬í„¸</h1>

      <Tabs defaultValue="shuttle" className="w-full">
        <TabsList className="mb-4 flex flex-wrap gap-2">
          <TabsTrigger value="shuttle">ğŸšŒ ì…”í‹€ë²„ìŠ¤</TabsTrigger>
          <TabsTrigger value="schedule">ğŸ“… ì‹œê°„í‘œ ë° í•™ì‚¬ì¼ì •</TabsTrigger>
          <TabsTrigger value="events">ğŸ‰ í•™êµ í–‰ì‚¬</TabsTrigger>
          <TabsTrigger value="bamboo">ğŸ‹ ëŒ€ë‚˜ë¬´ìˆ²</TabsTrigger>
        </TabsList>

        {/* ì…”í‹€ë²„ìŠ¤ ì •ë³´ íƒ­ */}
        <TabsContent value="shuttle">
          <Card>
            <CardContent className="p-4">
              <h2 className="text-xl font-semibold mb-2">ì…”í‹€ë²„ìŠ¤ ì‹œê°„í‘œ</h2>
              <ul className="list-disc list-inside space-y-1">
                <li>08:00 - ì •ë¬¸ ì¶œë°œ</li>
                <li>09:30 - í›„ë¬¸ ì¶œë°œ</li>
                <li>12:00 - ê¸°ìˆ™ì‚¬ ì¶œë°œ</li>
                <li>17:00 - ìº í¼ìŠ¤ ìˆœí™˜</li>
              </ul>
            </CardContent>
          </Card>
        </TabsContent>

        {/* ìˆ˜ì—… ì‹œê°„í‘œ ë° í•™ì‚¬ì¼ì • íƒ­ */}
        <TabsContent value="schedule">
          <Card>
            <CardContent className="p-4 space-y-6">
              <div>
                <h2 className="text-xl font-semibold mb-4">ìˆ˜ì—… ì‹œê°„í‘œ</h2>
                <table className="w-full table-auto border border-gray-300 text-sm">
                  <thead className="bg-gray-100">
                    <tr>
                      <th className="border px-4 py-2">ìš”ì¼</th>
                      <th className="border px-4 py-2">ê³¼ëª©</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td className="border px-4 py-2">ì›”ìš”ì¼</td><td className="border px-4 py-2">ì»´í“¨í„°ê³µí•™ / ìˆ˜í•™</td></tr>
                    <tr><td className="border px-4 py-2">í™”ìš”ì¼</td><td className="border px-4 py-2">ì˜ì–´ / í”„ë¡œê·¸ë˜ë°</td></tr>
                    <tr><td className="border px-4 py-2">ìˆ˜ìš”ì¼</td><td className="border px-4 py-2">ë°ì´í„°ë² ì´ìŠ¤ / ììœ¨í•™ìŠµ</td></tr>
                    <tr><td className="border px-4 py-2">ëª©ìš”ì¼</td><td className="border px-4 py-2">ì†Œí”„íŠ¸ì›¨ì–´ ê³µí•™ / ì²´ìœ¡</td></tr>
                    <tr><td className="border px-4 py-2">ê¸ˆìš”ì¼</td><td className="border px-4 py-2">í”„ë¡œì íŠ¸ ì‹¤ìŠµ</td></tr>
                  </tbody>
                </table>
              </div>

              <div>
                <h2 className="text-xl font-semibold mb-4">í•™ì‚¬ì¼ì •</h2>
                <div className="grid grid-cols-7 gap-2 text-center text-xs">
                  <div className="font-bold">ì¼</div><div className="font-bold">ì›”</div><div className="font-bold">í™”</div><div className="font-bold">ìˆ˜</div><div className="font-bold">ëª©</div><div className="font-bold">ê¸ˆ</div><div className="font-bold">í† </div>
                  {Array.from({ length: 30 }, (_, i) => {
                    const day = i + 1;
                    return (
                      <div
                        key={day}
                        className={`p-2 rounded border text-center ${
                          (day >= 15 && day <= 19) ? "bg-yellow-200" :
                          (day >= 10 && day <= 14) ? "bg-red-200" :
                          (day === 5 || day === 6) ? "bg-blue-200" : ""
                        }`}
                      >{day}</div>
                    );
                  })}
                </div>
                <div className="mt-2 text-xs space-y-1">
                  <div><span className="inline-block w-3 h-3 bg-yellow-200 mr-2"></span>ì¤‘ê°„ê³ ì‚¬</div>
                  <div><span className="inline-block w-3 h-3 bg-red-200 mr-2"></span>ê¸°ë§ê³ ì‚¬</div>
                  <div><span className="inline-block w-3 h-3 bg-blue-200 mr-2"></span>ê³µíœ´ì¼</div>
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        {/* í•™êµ í–‰ì‚¬ ë° ì°¸ê°€ ì‹ ì²­ íƒ­ */}
        <TabsContent value="events">
          <Card>
            <CardContent className="p-4 space-y-4">
              <div>
                <h2 className="text-xl font-semibold mb-2">ë‹¤ê°€ì˜¤ëŠ” í–‰ì‚¬</h2>
                <ul className="list-disc list-inside">
                  {eventList.map((event, index) => (
                    <li key={index}>{event.date} - {event.title}</li>
                  ))}
                </ul>
              </div>
              <div>
                <h2 className="text-xl font-semibold mb-2">ì°¸ê°€ ì‹ ì²­</h2>
                <form onSubmit={handleAddEvent} className="space-y-2">
                  <input
                    type="text"
                    placeholder="ì´ë¦„"
                    value={newEvent.name}
                    onChange={e => setNewEvent({ ...newEvent, name: e.target.value })}
                    className="border rounded p-2 w-full"
                  />
                  <input
                    type="text"
                    placeholder="ì°¸ê°€í•  í–‰ì‚¬ëª…"
                    value={newEvent.title}
                    onChange={e => setNewEvent({ ...newEvent, title: e.target.value })}
                    className="border rounded p-2 w-full"
                  />
                  <Button type="submit">ì‹ ì²­í•˜ê¸°</Button>
                </form>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        {/* ëŒ€ë‚˜ë¬´ìˆ² íƒ­ */}
        <TabsContent value="bamboo">
          <Card>
            <CardContent className="p-4 space-y-4">
              <h2 className="text-xl font-semibold">ğŸ‹ ìµëª… ëŒ€ë‚˜ë¬´ìˆ²</h2>
              <div className="space-y-4">
                {posts.map(post => (
                  <div key={post.id} className="border rounded p-3 bg-gray-50 space-y-2">
                    <div>{post.content}</div>
                    <div className="flex gap-3 text-sm">
                      <Button variant="outline" size="sm" onClick={() => handleLike(post.id)}>ğŸ‘ {post.likes}</Button>
                      <Button variant="outline" size="sm" onClick={() => handleReport(post.id)} disabled={post.reported}>
                        {post.reported ? "ğŸš¨ ì‹ ê³ ë¨" : "ğŸš¨ ì‹ ê³ "}
                      </Button>
                    </div>
                    <div className="mt-2">
                      <input
                        type="text"
                        className="border rounded p-1 text-sm w-full"
                        placeholder="ëŒ“ê¸€ ì‘ì„±..."
                        value={commentInputs[post.id] || ""}
                        onChange={e => setCommentInputs({ ...commentInputs, [post.id]: e.target.value })}
                      />
                      <Button size="sm" className="mt-1" onClick={() => handleComment(post.id)}>ëŒ“ê¸€ ë‹¬ê¸°</Button>
                      <ul className="mt-2 list-disc list-inside text-xs text-gray-600 space-y-1">
                        {post.comments.map((comment, i) => <li key={i}>{comment}</li>)}
                      </ul>
                    </div>
                  </div>
                ))}
              </div>
              <div className="flex gap-2 mt-4">
                <input
                  type="text"
                  value={newPost}
                  onChange={e => setNewPost(e.target.value)}
                  placeholder="ìµëª…ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ ë§ì„ ë‚¨ê²¨ë³´ì„¸ìš”"
                  className="border rounded p-2 flex-1"
                />
                <Button onClick={handlePost}>ì‘ì„±</Button>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
}
